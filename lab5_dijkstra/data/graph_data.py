# lab5_dijkstra/data/graph_data.py
import networkx as nx
import numpy as np

# Дані, витягнуті з "Додаток 2" (Частини 1 та 2)
INITIAL_ROADS = [
    # Частина 1 (з image_e8daa4.png)
    ('Вінниця', 'Житомир', 127),
    ('Вінниця', 'Київ', 267),
    ('Вінниця', 'Кропивницький', 320),
    ('Вінниця', 'Миколаїв', 428),
    ('Вінниця', 'Одеса', 423),
    ('Вінниця', 'Черкаси', 341),
    ('Вінниця', 'Чернівці', 276),
    ('Дніпро', 'Донецьк', 248),
    ('Дніпро', 'Запоріжжя', 85),
    ('Дніпро', 'Кропивницький', 244),
    ('Дніпро', 'Кривий Ріг', 146),
    ('Дніпро', 'Полтава', 160),
    ('Дніпро', 'Харків', 218),
    ('Донецьк', 'Луганськ', 156),
    ('Донецьк', 'Маріуполь', 113),
    ('Донецьк', 'Харків', 294),
    ('Запоріжжя', 'Мелітополь', 125),
    ('Івано-Франківськ', 'Тернопіль', 133),
    ('Івано-Франківськ', 'Ужгород', 293),
    ('Київ', 'Житомир', 140),
    ('Київ', 'Полтава', 340),
    ('Київ', 'Суми', 333),
    ('Київ', 'Черкаси', 189),
    ('Київ', 'Чернігів', 148),
    ('Кропивницький', 'Полтава', 246),
    ('Луганськ', 'Харків', 325),
    # Частина 2 (з image_e8dabf.png)
    ('Львів', 'Івано-Франківськ', 134),
    ('Львів', 'Луцьк', 151),
    ('Львів', 'Рівне', 211),
    ('Львів', 'Тернопіль', 127),
    ('Львів', 'Ужгород', 268),
    ('Львів', 'Чернівці', 278),  # У файлі 278, а не 276
    ('Мелітополь', 'Маріуполь', 192),
    ('Мелітополь', 'Сімферополь', 250),
    ('Миколаїв', 'Херсон', 69),
    ('Рівне', 'Житомир', 188),
    ('Рівне', 'Луцьк', 73),
    ('Рівне', 'Тернопіль', 155),
    ('Харків', 'Полтава', 143),
    ('Херсон', 'Мелітополь', 231),
    ('Хмельницький', 'Вінниця', 119),
    ('Хмельницький', 'Житомир', 183),
    ('Хмельницький', 'Рівне', 194),
    ('Хмельницький', 'Тернопіль', 112),
    ('Хмельницький', 'Чернівці', 187),
    ('Суми', 'Харків', 184),
    ('Черкаси', 'Полтава', 233),
    ('Полтава', 'Суми', 175),
    ('Чернігів', 'Суми', 306),
    ('Сімферополь', 'Севастополь', 81)
]

# Географічні координати для реалістичного відображення (приблизні)
# (x=довгота, y=широта)
CITY_COORDINATES = {
    'Київ': (30.5, 50.4),
    'Харків': (36.2, 50.0),
    'Одеса': (30.7, 46.4),
    'Дніпро': (35.0, 48.4),
    'Донецьк': (37.8, 48.0),
    'Запоріжжя': (35.1, 47.8),
    'Львів': (24.0, 49.8),
    'Кривий Ріг': (33.3, 47.9),
    'Миколаїв': (32.0, 46.9),
    'Маріуполь': (37.5, 47.1),
    'Луганськ': (39.3, 48.5),
    'Вінниця': (28.4, 49.2),
    'Херсон': (32.6, 46.6),
    'Полтава': (34.5, 49.5),
    'Чернігів': (31.3, 51.5),
    'Черкаси': (32.0, 49.4),
    'Суми': (34.8, 50.9),
    'Житомир': (28.6, 50.2),
    'Кропивницький': (32.2, 48.5),
    'Хмельницький': (27.0, 49.4),
    'Рівне': (26.2, 50.6),
    'Чернівці': (25.9, 48.3),
    'Тернопіль': (25.6, 49.5),
    'Івано-Франківськ': (24.7, 48.9),
    'Луцьк': (25.3, 50.7),
    'Ужгород': (22.3, 48.6),
    'Мелітополь': (35.3, 46.8),
    'Сімферополь': (34.1, 44.9),
    'Севастополь': (33.5, 44.6)
}


class GraphData:
    def __init__(self):
        self.graph = nx.Graph()
        self.load_initial_data()

    def load_initial_data(self):
        """Завантажує початкові дані з таблиці"""
        self.graph.clear()
        for city1, city2, distance in INITIAL_ROADS:
            self.graph.add_edge(city1, city2, weight=distance)

    def get_positions(self):
        """
        Повертає словник позицій.
        Використовує фіксовані координати для відомих міст
        і випадкові для нових.
        """
        fixed_pos = {}
        unknown_nodes = []

        for node in self.graph.nodes:
            if node in CITY_COORDINATES:
                fixed_pos[node] = CITY_COORDINATES[node]
            else:
                unknown_nodes.append(node)

        # Для нових міст, яких немає у списку, генеруємо випадкові позиції
        if unknown_nodes:
            # Створюємо маленький граф з невідомих вузлів, щоб розмістити їх
            unknown_subgraph = self.graph.subgraph(unknown_nodes)

            # Генеруємо випадкові позиції, але масштабуємо їх
            # (щоб вони не накладались на головну мапу)
            random_pos = nx.spring_layout(unknown_subgraph, seed=42, k=5)

            # Об'єднуємо словники
            fixed_pos.update(random_pos)

        return fixed_pos

    def get_cities(self):
        """Повертає відсортований список всіх міст у графі"""
        return sorted(list(self.graph.nodes))

    def add_city(self, city_name):
        """Додає нове місто (вершину)"""
        if city_name and city_name not in self.graph:
            self.graph.add_node(city_name)
            return True
        return False

    def remove_city(self, city_name):
        """Видаляє місто і всі пов'язані з ним шляхи"""
        if city_name in self.graph:
            self.graph.remove_node(city_name)
            return True
        return False

    def add_road(self, city1, city2, distance):
        """Додає новий шлях (ребро)"""
        if city1 in self.graph and city2 in self.graph and distance > 0:
            self.graph.add_edge(city1, city2, weight=distance)
            return True
        return False

    def remove_road(self, city1, city2):
        """Видаляє шлях між містами"""
        if self.graph.has_edge(city1, city2):
            self.graph.remove_edge(city1, city2)
            return True
        return False